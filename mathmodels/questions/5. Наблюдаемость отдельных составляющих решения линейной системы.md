##### 5. Наблюдаемость отдельных составляющих решения линейной системы. Пример программы модального анализа.
## Формула Лагранжа-Сильвестра
Пусть
$$\begin{align}
\mA \mathbf{u}_k&=\lambda_k\mathbf{u}_k \\
\mA^T\mathbf{v}_i&=\lambda_i\mathbf{v}_i
\end{align}
$$
Транспонируем последнюю формулу.
$$\mathbf{v}_i^T\mA=\lambda_i\mathbf{v}_i^T$$
Первую формулу умножаем слева на $\mathbf{v}_i^T$, а третью справа на $\mathbf{u}_k$, вычитаем.
$$0=(\lambda_k-\lambda_i)\mathbf{v}_i^T\mathbf{u}_k$$
Если $k\neq i$, то
$$\mathbf{v}_i^T\mathbf{u}_k=0$$
Дополнительно нормируем эти векторы так, что
$$\mathbf{v}_k^T\mathbf{u}_k=1$$
Формула Лагранжа-Сильвестра
$$\displaylines{
\mathbf{f}(\mathbf{A})=\sum_{k=1}^{m}\mathbf{T}_kf(\lambda_k)\\
\mathbf{T}_k=\frac
{
(\mA-\lambda_1\mE)\dots(\mA-\lambda_{k-1}\mE)
(\mA-\lambda_{k+1}\mE)\dots(\mA-\lambda_{m}\mE)
}
{
(\lambda_k-\lambda_1)\dots(\lambda_k-\lambda_{k-1})
(\lambda_k-\lambda_{k+1})\dots(\lambda_k-\lambda_{m})
}
}$$
Для чужих собственных векторов $i\neq k$ (так как $(\mA-\lambda_i\mE)\times \mathbf{u}_i=\mathbf{0}$)
$$\mathbf{T}_k\mathbf{u}_i=0$$
Для своих собственных векторов (умножить все множители на $\mathbf{u}_k$)
$$\mathbf{T}_k\mathbf{u}_k=\mathbf{u}_k$$
Разложим каждую строку
$$\mathbf{T}_k=\sum_{j=1}^m\mathbf{c}_j\mathbf{v}_j^T$$
Если $k\neq i$ 
$$\mathbf{T}_k\mathbf{u}_i=
\sum_{j=1}^m(\mathbf{c}_j\mathbf{v}_j^T) \mathbf{u}_i=
\sum_{j=1}^m\mathbf{c}_j(\mathbf{v}_j^T \mathbf{u}_i)=
\mathbf{c}_i(\mathbf{v}_i^T \mathbf{u}_i)=\mathbf{c}_i=\mathbf{0}$$
То есть
$$\mathbf{T}_k=\mathbf{c}_k\mathbf{v}_k^T$$
Подставляем это в выражение со своими собственными векторами
$$(\mathbf{c}_k\mathbf{v}_k^T)\mathbf{u}_k=
\mathbf{c}_k(\mathbf{v}_k^T\mathbf{u}_k)=
\mathbf{c}_k=\mathbf{u}_k$$
Теперь формулу Лагранжа-Сильвестра можно записать так
$$\mathbf{f}(\mA)=\sum_{k=1}^m \mathbf{u}_k\mathbf{v}_k^Tf(\lambda_k)$$
## Наблюдаемость отдельных составляющих
Запишем решение через матричную экспоненту по формуле Лагранжа-Сильвестра, когда $\mB=\mathbf{0}$.
$$\mx(t)=e^{\mA t}\mx_0=\sum_{k=1}^m\bu_k\mv_k^T e^{\lambda_k t}\mx_0=\sum_{k=1}^m\bu_k(\mv_k^T \mx_0)e^{\lambda_k t}$$
Составляющая $e^{\lambda_k t}$ называется ***модой***, анализ — ***модальным анализом***.
Пусть
$$D_k=\mv_k^T\mx_0$$
Покомпонентно запишем решение.
$$\begin{align}
x^{(1)}(t)&=u_1^{(1)}D_1e^{\lambda_1 t}+
u_2^{(1)}D_2e^{\lambda_2 t}+\dots+
u_m^{(1)}D_me^{\lambda_m t}\\
x^{(2)}(t)&=u_1^{(2)}D_1e^{\lambda_1 t}+
u_2^{(2)}D_2e^{\lambda_2 t}+\dots+
u_m^{(2)}D_me^{\lambda_m t}\\
\vdots\\
x^{(m)}(t)&=u_1^{(m)}D_1e^{\lambda_1 t}+
u_2^{(m)}D_2e^{\lambda_2 t}+\dots+
u_m^{(m)}D_me^{\lambda_m t}
\end{align}$$
> [!вопрос] 
> Насколько заметнее $k$-я мода $e^{\lambda_k t}$ наблюдается в $x^{(p)}(t)$ по сравнению с $x^{(s)}(t)$?

Отношение амплитуд выражается частным
$$\eta_k^{(p,s)}=\frac{u_k^{(p)}D_k}{u_k^{(s)}D_k}=\frac{u_k^{(p)}}{u_k^{(s)}}$$
Оно **не зависит от начальных условий** $\mx_0$ и полностью определяется компонентами собственного вектора $\bu_k$.

Введём упрощающие предположения. Каждый узел описывается дифференциальным уравнением. Все они имеют одинаковую природу и размерность.
$$\frac{dx^{(p)}}{dt}=\dots$$
Возмущения будем задавать вектором начальных условий, где одна компонента равна единице, остальные нули.
$$\mx_0=\mathbf{e}_i=(0,0,\dots,0,1,0,\dots,0,0)^T$$
## Подсистема 1. Оценка поведения $k$-й моды $e^{\lambda_k t}$
Выбираем наибольшую по модулю компоненту $u_k$ и делим другие на неё, получаем относительную амплитуду.

***Наблюдаемость $k$-й моды***

| Номер узла | Относительная амплитуда |
|------------|-------------------------|
| 14         | 100%                    |
| 3          | 92%                     |
| 115        | 14%                     |
| 7          | 0.2%                    |
| ...        | ...                     |

Мода ***локальная***, если она заметно наблюдается в небольшом числе узлов. Иначе она называется ***системной***.

Величина $D_k=\mv_k^T\mx_0$ достигает максимума, если ненулевую компоненту $\mx_0$ задать там, где компонента $\mv_k$ наибольшая по модулю.

***Возмущаемость $k$-й моды***

| Номер узла | Относительная амплитуда |
|------------|-------------------------|
| 14         | 100%                    |
| 6          | 78%                     |
| 217        | 9%                      |
| 29         | 0.05%                   |
| ...        | ...                     |

## Подсистема 2. Наблюдение в данном узле
Интерес вызывает только одна составляющая решения
$$x^{(k)}(t)=u_1^{(k)}D_1e^{\lambda_1 t}+
u_2^{(k)}D_2e^{\lambda_2 t}+\dots+
u_m^{(k)}D_me^{\lambda_m t}$$
Задача — указать, какая мода будет иметь максимальную амплитуду, и упорядочить моды по убыванию этих амплитуд. Для каждой моды указан узел, где возмущение наиболее эффективно.

| Номер моды | Относительная амплитуда | Эффективный узел возмущения |
|------------|-------------------------|-----------------------------|
| 4          | 65%                     | 7                           |
| 13         | 15%                     | 14                          |
| 6          | 14%                     | 113                         |
| 25         | 3%                      | 3                           |
| ...        | ...                     | ...                         |

## Подсистема 3. Возмущение в данном узле
Интерес вызывают последствия возмущения в данном узле. Таким образом, $\mx_0$ и $D_j$ известны.

| Номер моды | Относительная амплитуда | Эффективный узел наблюдения |
|------------|-------------------------|-----------------------------|
| 4          | 65%                     | 7                           |
| 13         | 15%                     | 14                          |
| 6          | 14%                     | 113                         |
| 25         | 3%                      | 3                           |
| ...        | ...                     | ...                         |
